import streamlit as st
import numpy as np
import pandas as pd
import plotly.express as px
import cvxpy as cp
import scipy.stats as stats

st.set_page_config(page_title="ููุตุฉ ุงูุญูููุฉ ุงููุชูุฏูุฉ", layout="wide")

st.markdown("""
<style>
* {direction: rtl; text-align: right;}
</style>
""", unsafe_allow_html=True)

st.title("๐ ููุตุฉ ูุญุงูุงุฉ ูุชูููู ุงูุญูููุฉ ุงููุชูุฏูุฉ ูู ุงูุจููู ุงูุชุดุงุฑููุฉ")
st.markdown("๐ก ูุฐู ุงูููุตุฉ ุชูุงุนููุฉ ุชุณุงุนุฏ ุนูู ููุงุณ ุฌูุฏุฉ ุงูุญูููุฉ ูู ุงูุจููู ุงูุชุดุงุฑููุฉุ ููุญุงูุงุฉ ุชุฃุซูุฑูุง ุนูู ุงูุฃุฏุงุก ุงููุงูู ูุณุฑุนุฉ ุชุนุฏูู ุฑุฃุณ ุงููุงู. ููุงุณุจุฉ ููุจุงุญุซููุ ุงูุทูุงุจุ ูุงูููุงุฑุณูู.")

# ุชุจููุจุงุช ุฑุฆูุณูุฉ
tab1, tab2, tab3, tab4, tab5, tab6 = st.tabs([
    "1๏ธโฃ ุฅุฏุฎุงู ูุคุดุฑุงุช ุงูุญูููุฉ",
    "2๏ธโฃ ูุญุงูุงุฉ ุชุนุฏูู ุฑุฃุณ ุงููุงู",
    "3๏ธโฃ ุชุญููู ุงูุฃุฏุงุก ุงููุงูู",
    "4๏ธโฃ ุชูููู ุฌูุฏุฉ ุงูุญูููุฉ",
    "5๏ธโฃ ุชุญุณูู ุฑุฃุณ ุงููุงู",
    "6๏ธโฃ ุชุญุณูู ุงูุนุงุฆุฏ"
])

with tab1:
    st.subheader("1๏ธโฃ ุฅุฏุฎุงู ูุคุดุฑุงุช ุงูุญูููุฉ")
    st.markdown("๐ ูู ูุฐุง ุงููุณู ููููู ุฅุฏุฎุงู ุฏุฑุฌุงุช ุชูููู ููููุงุช ุงูุญูููุฉ ููุจูู ูุซู ุงูุดูุงููุฉุ ุงูุงุณุชููุงููุฉุ ูุงููุฎุงุทุฑ. ุณูุชู ุญุณุงุจ ูุคุดุฑ ุงูุญูููุฉ ุงูููู ุจูุงุกู ุนูู ูุฐู ุงูููู ูุชูุณุชุฎุฏู ูุงุญููุง ูู ุงูุชุญููู ูุงููุญุงูุงุฉ.")
    
    with st.expander("๐ ูุง ูู ูููุฌูุฉ ุญุณุงุจ ูุคุดุฑ ุงูุญูููุฉุ"):
        st.markdown("""
        ูุชู ุญุณุงุจ ูุคุดุฑ ุงูุญูููุฉ ุงูููู ุจูุงุกู ุนูู **ูุชูุณุท ูุฑุฌูุญ** ููุฌููุนุฉ ูู ุงููุคุดุฑุงุช ุงููุฑุนูุฉ:

        - ๐ ุงูุดูุงููุฉ ูุงูุฅูุตุงุญ (25%)
        - ๐ฅ ุงุณุชููุงููุฉ ูุฌูุณ ุงูุฅุฏุงุฑุฉ (25%)
        - ๐ ูุงุนููุฉ ูุฌูุฉ ุงููุฑุงุฌุนุฉ (20%)
        - โ๏ธ ุฏูุฑ ูุฌูุฉ ุงููุฎุงุทุฑ (15%)
        - ๐ก๏ธ ุญูุงูุฉ ุญููู ุงููุณุงูููู (15%)

        ูู ูุคุดุฑ ููููููู ูู 0 ุฅูู 10ุ ูููุญุณุจ ุงููุคุดุฑ ุงูููุงุฆู ููุชูุณุท ูุฑุฌูุญ ูุนูุณ ูุณุชูู ุงูุญูููุฉ ุงููุคุณุณูุฉ.
        """)

    transparency = st.number_input("ุงูุดูุงููุฉ ูุงูุฅูุตุงุญ", min_value=0.0, max_value=10.0, value=6.0, step=0.1, format="%.1f")
    board_independence = st.number_input("ุงุณุชููุงููุฉ ูุฌูุณ ุงูุฅุฏุงุฑุฉ", min_value=0.0, max_value=10.0, value=5.0, step=0.1, format="%.1f")
    audit_committee = st.number_input("ูุงุนููุฉ ูุฌูุฉ ุงููุฑุงุฌุนุฉ", min_value=0.0, max_value=10.0, value=7.0, step=0.1, format="%.1f")
    risk_committee = st.number_input("ุฏูุฑ ูุฌูุฉ ุงููุฎุงุทุฑ", min_value=0.0, max_value=10.0, value=4.0, step=0.1, format="%.1f")
    shareholder_rights = st.number_input("ุญูุงูุฉ ุญููู ุงููุณุงูููู", min_value=0.0, max_value=10.0, value=6.0, step=0.1, format="%.1f")

    if st.button("ุญุณุงุจ ูุคุดุฑ ุงูุญูููุฉ"):
        weights = {
            "transparency": 0.25,
            "board": 0.25,
            "audit": 0.2,
            "risk": 0.15,
            "shareholders": 0.15
        }

        governance_metrics = {
            "transparency": transparency,
            "board": board_independence,
            "audit": audit_committee,
            "risk": risk_committee,
            "shareholders": shareholder_rights
        }

        governance_score = sum(governance_metrics[k] * weights[k] for k in governance_metrics)

        st.session_state["governance_score"] = governance_score

        st.success(f"โ ูุคุดุฑ ุงูุญูููุฉ ุงูููู: {governance_score:.2f} / 10")

        # ุฑุณู ุจูุงูู ุชูุฒูุน ุงูุฏุฑุฌุงุช
        fig_bar = px.bar(
            x=["ุงูุดูุงููุฉ", "ุงูุงุณุชููุงููุฉ", "ุงููุฑุงุฌุนุฉ", "ุงููุฎุงุทุฑ", "ุญููู ุงููุณุงูููู"],
            y=list(governance_metrics.values()),
            labels={"x": "ุงููููู", "y": "ุงูุฏุฑุฌุฉ"},
            title="ุชูุฒูุน ุฏุฑุฌุงุช ูุคุดุฑุงุช ุงูุญูููุฉ",
            range_y=[0, 10],
            color=list(governance_metrics.values()),
            color_continuous_scale=px.colors.sequential.Teal
        )
        st.plotly_chart(fig_bar)

        # ุญุณุงุจ ุงููุณุงููุฉ ุงููุณุจูุฉ (ุงููุณุจุฉ ุงููุฆููุฉ)
        percentages = {k: governance_metrics[k] * weights[k] * 10 for k in governance_metrics}

        labels_ar = {
            "transparency": "ุงูุดูุงููุฉ",
            "board": "ุงูุงุณุชููุงููุฉ",
            "audit": "ุงููุฑุงุฌุนุฉ",
            "risk": "ุงููุฎุงุทุฑ",
            "shareholders": "ุญููู ุงููุณุงูููู"
        }

        df_percent = pd.DataFrame({
            "ุงููููู": [labels_ar[k] for k in percentages.keys()],
            "ุงููุณุงููุฉ ูู ุงููุคุดุฑ ุงูููู (%)": list(percentages.values())
        })

        st.table(df_percent.style.format({"ุงููุณุงููุฉ ูู ุงููุคุดุฑ ุงูููู (%)": "{:.2f}"}))

        # ุชูุตูุงุช ููุตูุฉ
        st.markdown("###  ุชูุตูุงุช ุชูุตูููุฉ:")
        if transparency < 5:
            st.markdown("- ๐ ุชุญุณูู ุงูุดูุงููุฉ ูุงูุฅูุตุงุญ.")
        if board_independence < 5:
            st.markdown("- ๐ฅ ุชุนุฒูุฒ ุงุณุชููุงููุฉ ูุฌูุณ ุงูุฅุฏุงุฑุฉ.")
        if audit_committee < 5:
            st.markdown("- ๐ ุชุญุณูู ูุงุนููุฉ ูุฌูุฉ ุงููุฑุงุฌุนุฉ.")
        if risk_committee < 5:
            st.markdown("- โ๏ธ ุชูุนูู ุฏูุฑ ูุฌูุฉ ุงููุฎุงุทุฑ.")
        if shareholder_rights < 5:
            st.markdown("- ๐ก๏ธ ุถูุงู ุญูุงูุฉ ุญููู ุงููุณุงูููู.")

        # ูุต ุชุญูููู ููุณุฑ ููุชูุฌุฉ ุงููุคุดุฑ
        st.markdown("---")
        st.markdown("#### ๐ ุชูุณูุฑ ุนุงู ููุคุดุฑ ุงูุญูููุฉ ุงูููู:")
        if governance_score >= 8:
            st.success(
                "ูุคุดุฑ ุงูุญูููุฉ ูุฑุชูุน ุฌุฏูุงุ ููุง ูุฏู ุนูู ูููู ุญูููุฉ ููู ููุนูุงู ูุฏุนู ุงุณุชูุฑุงุฑ ุงูุจูู ููุฏุฑุชู ุนูู ููุงุฌูุฉ ุงูุตุฏูุงุช."
            )
        elif governance_score >= 5:
            st.warning(
                "ูุคุดุฑ ุงูุญูููุฉ ูุชูุณุทุ ูููุงู ุญุงุฌุฉ ูุชุญุณูู ุจุนุถ ุงูุฌูุงูุจ ูุชุนุฒูุฒ ุงูุงุณุชูุฑุงุฑ ูุงูุดูุงููุฉ."
            )
        else:
            st.error(
                "ูุคุดุฑ ุงูุญูููุฉ ููุฎูุถุ ููุฐุง ูุดูุฑ ุฅูู ูุฎุงุทุฑ ุนูู ุงุณุชุฏุงูุฉ ุงูุจูู ููุณุชูุฒู ุฅุฌุฑุงุกุงุช ุชุญุณูู ููุฑูุฉ."
            )

with tab2:
    st.subheader("2๏ธโฃ ูุญุงูุงุฉ ุชุนุฏูู ุฑุฃุณ ุงููุงู")
    st.markdown("๐ ูู ูุฐุง ุงููุณู ููููู ูุญุงูุงุฉ ูุฏู ุณุฑุนุฉ ุงุณุชุฌุงุจุฉ ุงูุจูู ูุชุนุฏูู ุฑุฃุณ ูุงูู ุนูุฏ ุญุฏูุซ ุตุฏูุฉ ูุงููุฉ. ุชุนุชูุฏ ุงููุชูุฌุฉ ุนูู ูุณุชูู ุงูุญูููุฉ ูููุน ุงูุตุฏูุฉ ููููุฉ ุฑุฃุณ ุงููุงู.")

    
    with st.expander("๐ ููู ูุชู ุญุณุงุจ ุณุฑุนุฉ ุชุนุฏูู ุฑุฃุณ ุงููุงูุ"):
        st.markdown("""
        ุชุณุชุฎุฏู ุงูููุตุฉ ูุฐู ุงููุนุงุฏูุฉ ููุญุงูุงุฉ ุฒูู ุชุนุฏูู ุฑุฃุณ ุงููุงู ุจุนุฏ ุงูุตุฏูุฉ:

        $$
        \\text{ุงููุฏุฉ (ุจุงูุฃูุงู)} = \\frac{\\text{ุฑุฃุณ ุงููุงู} \\times \\text{ูุนุงูู ุงูุตุฏูุฉ}}{\\text{ูุคุดุฑ ุงูุญูููุฉ} + 1}
        $$

        - ๐ฆ ุฑุฃุณ ุงููุงู ููุฏุฎู ุจุงูููููู.
        - โ๏ธ ููุน ุงูุตุฏูุฉ ูุญุฏุฏ ูุนุงูููุง:
            - ุงูุฎูุงุถ ุงูุณูููุฉ = 0.3
            - ุฎุณุงุฆุฑ ุชุดุบูููุฉ = 0.5
            - ุชุดุฏูุฏ ุฑูุงุจู = 0.4
        - ๐ ูููุง ุงุฑุชูุน ูุคุดุฑ ุงูุญูููุฉุ ููุช ุงููุฏุฉ ุงูุฒูููุฉ.
        """)

    if "governance_score" not in st.session_state:
        st.error("โ๏ธ ุงูุฑุฌุงุก ุฅุฏุฎุงู ูุคุดุฑุงุช ุงูุญูููุฉ ุฃููุงู ูู ุงูุชุจููุจ 1.")
    else:
        capital = st.number_input("ุฑุฃุณ ุงููุงู ุงูุญุงูู (ุจุงูููููู)", min_value=0.0, value=100.0)
        shock_type = st.selectbox("ููุน ุงูุตุฏูุฉ", ["ุงูุฎูุงุถ ูู ุงูุณูููุฉ", "ุฎุณุงุฆุฑ ุชุดุบูููุฉ", "ุชุดุฏูุฏ ุฑูุงุจู"])

        def simulate_adjustment(capital, governance_score, shock_type):
            impact = {"ุงูุฎูุงุถ ูู ุงูุณูููุฉ": 0.3, "ุฎุณุงุฆุฑ ุชุดุบูููุฉ": 0.5, "ุชุดุฏูุฏ ุฑูุงุจู": 0.4}
            duration = (capital * impact[shock_type]) / (governance_score + 1)
            return round(duration, 2)

        if st.button("ุชูููุฐ ุงููุญุงูุงุฉ"):
            days = simulate_adjustment(capital, st.session_state["governance_score"], shock_type)
            st.success(f"โฑ๏ธ ุงูุฒูู ุงูุชูุฏูุฑู ูุชุนุฏูู ุฑุฃุณ ุงููุงู: **{days} ููููุง**")

            if days <= 7:
                st.info("โ ุงุณุชุฌุงุจุฉ ุณุฑูุนุฉ ุชุฏู ุนูู ุญูููุฉ ูููุฉ ููุฑููุฉ ูุงููุฉ.")
            elif days <= 14:
                st.warning("โ๏ธ ุงุณุชุฌุงุจุฉ ูุชูุณุทุฉุ ููุตุญ ุจุชุญุณูู ุงูุณูููุฉ.")
            else:
                st.error("โ ุงุณุชุฌุงุจุฉ ุจุทูุฆุฉุ ูุฏ ุชุคุซุฑ ุนูู ุงูุงุณุชูุฑุงุฑ ุงููุงูู.")

            timeline = list(range(1, int(days) + 1))
            values = [capital - (i * capital * 0.025) for i in timeline]
            df_chart = pd.DataFrame({"ููู": timeline, "ุฑุฃุณ ุงููุงู ุงููุชููุน": values})
            st.line_chart(df_chart.set_index("ููู"))

            decrease_pct = round((capital - values[-1]) / capital * 100, 2)
            st.metric(label="ุงููุณุจุฉ ุงููุฆููุฉ ููุงูุฎูุงุถ ูู ุฑุฃุณ ุงููุงู", value=f"{decrease_pct}%")

            st.markdown("###  ุชูุตูุงุช ูุฎุตุตุฉ:")
            if st.session_state["governance_score"] < 6:
                st.markdown("- ๐ ุชุญุณูู ูุคุดุฑุงุช ุงูุญูููุฉุ ุฎุงุตุฉ ุงูุดูุงููุฉ ูุงููุฎุงุทุฑ.")
            if shock_type == "ุฎุณุงุฆุฑ ุชุดุบูููุฉ":
                st.markdown("- โ๏ธ ุชูููุฉ ุฃูุธูุฉ ุงูุฑูุงุจุฉ ุงูุชุดุบูููุฉ.")
            if shock_type == "ุงูุฎูุงุถ ูู ุงูุณูููุฉ":
                st.markdown("- ๐ง ุชุญุณูู ุฅุฏุงุฑุฉ ุงูุณูููุฉ.")
            if shock_type == "ุชุดุฏูุฏ ุฑูุงุจู":
                st.markdown("- ๐ ูุฑุงุฌุนุฉ ุงูุงูุชุฒุงู ุงูุชูุธููู.")

            #  ูุต ุชุญูููู ููุณุฑ
            st.markdown("---")
            st.markdown("#### ๐ ุชูุณูุฑ ูุชูุฌุฉ ุงููุญุงูุงุฉ:")
            if days <= 7:
                st.success(
                    "ูุฏุฉ ุชุนุฏูู ุฑุฃุณ ุงููุงู ุงููุตูุฑุฉ ุชุนูุณ ูุฏุฑุฉ ุงูุจูู ุนูู ุงูุงุณุชุฌุงุจุฉ ุงูุณุฑูุนุฉ ูุงูุชุนุงูู ูุน ุงูุตุฏูุงุช ุงููุงููุฉ ุจูุนุงููุฉุ "
                    "ููู ุนูุงูุฉ ุฅูุฌุงุจูุฉ ุชุนูุณ ููุฉ ุงูุญูููุฉ ูุงูุณูููุฉ."
                )
            elif days <= 14:
                st.warning(
                    "ูุฏุฉ ุชุนุฏูู ุฑุฃุณ ุงููุงู ุงููุชูุณุทุฉ ุชุดูุฑ ุฅูู ูุฌูุฏ ุจุนุถ ุงูุชุญุฏูุงุช ูู ุณุฑุนุฉ ุงูุชููู ูุน ุงูุตุฏูุงุชุ "
                    "ูููุตุญ ุจูุฑุงุฌุนุฉ ุขููุงุช ุฅุฏุงุฑุฉ ุงูุณูููุฉ ูุชุญุณูู ุงูุญูููุฉ ูุชุนุฒูุฒ ุงููุฑููุฉ."
                )
            else:
                st.error(
                    "ูุฏุฉ ุชุนุฏูู ุฑุฃุณ ุงููุงู ุงูุทูููุฉ ุชูุจู ุฅูู ูุฌูุฏ ูุดุงูู ุฌููุฑูุฉ ูู ุงููุฏุฑุฉ ุนูู ุงูุงุณุชุฌุงุจุฉุ "
                    "ููุง ูุฏ ูุนุฑุถ ุงูุจูู ููุฎุงุทุฑ ูุงููุฉ ูุจูุฑุฉ ููุญุชุงุฌ ุฅูู ุฅุตูุงุญุงุช ุนุงุฌูุฉ ูู ุงูุญูููุฉ ูุฅุฏุงุฑุฉ ุงููุฎุงุทุฑ."
                )

with tab3:
    st.subheader("3๏ธโฃ ุชุญููู ุงูุฃุฏุงุก ุงููุงูู")
    st.markdown("๐ ูู ูุฐุง ุงููุณู ููููู ูุญุงูุงุฉ ูุฏู ุณุฑุนุฉ ุงุณุชุฌุงุจุฉ ุงูุจูู ูุชุนุฏูู ุฑุฃุณ ูุงูู ุนูุฏ ุญุฏูุซ ุตุฏูุฉ ูุงููุฉ. ุชุนุชูุฏ ุงููุชูุฌุฉ ุนูู ูุณุชูู ุงูุญูููุฉ ูููุน ุงูุตุฏูุฉ ููููุฉ ุฑุฃุณ ุงููุงู.")

    with st.expander("๐ ููู ูุชู ุชุญููู ุงูุนูุงูุฉ ุจูู ุงูุญูููุฉ ูุงูุฃุฏุงุก ุงููุงููุ"):
        st.markdown("""
        ูุชู ุงุณุชุฎุฏุงู ูุนุงูู ุงูุงุฑุชุจุงุท ุจูุฑุณูู (Pearson Correlation) ูููุงุณ ุงูุนูุงูุฉ ุจูู `Governance_Score` ูุฃุญุฏ ุงููุคุดุฑุงุช ุงููุงููุฉ ูุซู ROA ุฃู ROE.

        - ูุนุงูู ุงูุงุฑุชุจุงุท ููุญุณุจ ุนูู ุงูุจูุงูุงุช ุงูุฑูููุฉ ุจุนุฏ ุชูุธูููุง.
        - ููู ูุนุงูู ุงูุงุฑุชุจุงุท:
            - โ ุจูู 0.7 ู 1.0: ุนูุงูุฉ ูููุฉ ุฌุฏูุง
            - โ๏ธ ุจูู 0.4 ู 0.7: ุนูุงูุฉ ูุชูุณุทุฉ
            - ๐ ุจูู 0.2 ู 0.4: ุนูุงูุฉ ุถุนููุฉ
            - โ ุฃูู ูู 0.2: ูุง ุชูุฌุฏ ุนูุงูุฉ

        โ๏ธ ุชุฃูุฏ ูู ุชููุน ุงูุจูุงูุงุช ููุญุตูู ุนูู ูุชุงุฆุฌ ุฏูููุฉ.
        """)

    if "governance_score" not in st.session_state:
        st.error("โ๏ธ ุงูุฑุฌุงุก ุฅููุงู ุฅุฏุฎุงู ูุคุดุฑุงุช ุงูุญูููุฉ ูู ุงูุชุจููุจ 1 ุฃููุงู.")
    else:
        uploaded_file = st.file_uploader("๐ ุงุฑูุน ููู ุงูุฃุฏุงุก ุงููุงูู (CSV ุฃู Excel)", type=["csv", "xlsx"])
        if uploaded_file:
            if uploaded_file.name.endswith("csv"):
                df = pd.read_csv(uploaded_file)
            else:
                df = pd.read_excel(uploaded_file)
            st.dataframe(df.head())

            if "Governance_Score" not in df.columns:
                df["Governance_Score"] = st.session_state["governance_score"]
                st.info("โ ุชู ุฅุถุงูุฉ ุนููุฏ ูุคุดุฑ ุงูุญูููุฉ ุชููุงุฆููุง.")

            num_cols = df.select_dtypes(include=["float", "int"]).columns.tolist()
            if "Governance_Score" in num_cols:
                num_cols.remove("Governance_Score")

            if num_cols:
                selected_metric = st.selectbox("๐ ุงุฎุชุฑ ูุคุดุฑูุง ูุงูููุง ููุชุญููู", num_cols)

                # ุชูุธูู ุงูุจูุงูุงุช
                df_clean = df[["Governance_Score", selected_metric]].copy()
                df_clean["Governance_Score"] = pd.to_numeric(df_clean["Governance_Score"], errors="coerce")
                df_clean[selected_metric] = pd.to_numeric(df_clean[selected_metric], errors="coerce")
                df_clean = df_clean.dropna()

                if df_clean["Governance_Score"].nunique() <= 1 or df_clean[selected_metric].nunique() <= 1:
                    st.warning("โ๏ธ ุงูุจูุงูุงุช ูุง ุชุญุชูู ุนูู ุชุจุงูู ูุงูู ูุญุณุงุจ ูุนุงูู ุงูุงุฑุชุจุงุท.")
                else:
                    corr = df_clean["Governance_Score"].corr(df_clean[selected_metric])
                    st.metric(label="ูุนุงูู ุงูุงุฑุชุจุงุท", value=f"{corr:.2f}")

                    fig = px.scatter(df_clean, x="Governance_Score", y=selected_metric,
                                     trendline="ols",
                                     title=f"ุงูุนูุงูุฉ ุจูู ุงูุญูููุฉ ู {selected_metric}",
                                     labels={"Governance_Score": "ูุคุดุฑ ุงูุญูููุฉ", selected_metric: selected_metric})
                    st.plotly_chart(fig)

                    if corr >= 0.7:
                        st.success("โ ุนูุงูุฉ ูููุฉ ุฌุฏูุง ุจูู ุงูุญูููุฉ ูุงููุคุดุฑ ุงููุงูู.")
                    elif corr >= 0.4:
                        st.info("โน๏ธ ุนูุงูุฉ ูุนุชุฏูุฉุ ุชุญุชุงุฌ ูุฑุงูุจุฉ ูุชุญุณูู.")
                    elif corr >= 0.2:
                        st.warning("โ๏ธ ุนูุงูุฉ ุถุนููุฉ ูุณุจููุงุ ููุตุญ ุจุงูุชุญูู ูู ุงูุจูุงูุงุช.")
                    else:
                        st.error("โ ูุง ุชูุฌุฏ ุนูุงูุฉ ูุงุถุญุฉ.")

                    # ุงูุชูุณูุฑ ุงูุชูุตููู
                    st.markdown("---")
                    st.markdown("#### ๐ ุชูุณูุฑ ุชูุตููู ููุชูุฌุฉ ูุนุงูู ุงูุงุฑุชุจุงุท:")

                    if corr >= 0.7:
                        st.success(
                            "ุงูุนูุงูุฉ ุงููููุฉ ุจูู ุงูุญูููุฉ ูุงูุฃุฏุงุก ุงููุงูู ุชุนูู ุฃู ุงูุจูู ุงูุฐู ูุชูุชุน ุจููุงูู ุญูููุฉ ูููุฉ "
                            "ูุญูู ุนุงุฏุฉ ุฃุฏุงุก ูุงูู ุฃูุถู. ูุฐุง ูููู ุฃู ูุนูุฏ ุฅูู:\n"
                            "- ููุงุกุฉ ุฃูุจุฑ ูู ุงุชุฎุงุฐ ุงููุฑุงุฑุงุช\n"
                            "- ุชูููู ุงููุฎุงุทุฑ ุงูุชุดุบูููุฉ ูุงููุงููุฉ\n"
                            "- ุชุญุณูู ุซูุฉ ุงููุณุชุซูุฑูู ูุงูุดุฑูุงุก\n"
                            "- ุงูุชุฒุงู ุฃูุถู ุจุงููุนุงููุฑ ูุงูุดูุงููุฉ"
                        )
                    elif corr >= 0.4:
                        st.info(
                            "ุงูุนูุงูุฉ ุงููุชูุณุทุฉ ุชุนูู ูุฌูุฏ ุชุฃุซูุฑ ููุญูุธ ููุญูููุฉ ุนูู ุงูุฃุฏุงุกุ ูููู ููุงู ุนูุงูู ุฃุฎุฑู "
                            "ูุฏ ุชุคุซุฑ ุฃูุถูุง. ููุตุญ ุจุงููุธุฑ ูู:\n"
                            "- ุฌูุฏุฉ ุงูุจูุงูุงุช ุงููุณุชุฎุฏูุฉ\n"
                            "- ุชุญููู ุฃุนูู ููุนูุงูู ุงูุฎุงุฑุฌูุฉ\n"
                            "- ูุฑุงุฌุนุฉ ูุคุดุฑุงุช ุงูุญูููุฉ ุงููุฎุชุงุฑุฉ"
                        )
                    elif corr >= 0.2:
                        st.warning(
                            "ุงูุนูุงูุฉ ุงูุถุนููุฉ ูุณุจูุงู ุชุดูุฑ ุฅูู ุฃู ุงูุญูููุฉ ุชุคุซุฑ ุจุดูู ูุญุฏูุฏ ุนูู ุงูุฃุฏุงุก ุงููุงูู ูู ูุฐู ุงูุจูุงูุงุช. "
                            "ูุฏ ูุฑุฌุน ุฐูู ุฅูู:\n"
                            "- ุนุฏู ููุงูุฉ ุงูุชููุน ูู ุงูุจูุงูุงุช\n"
                            "- ูุฌูุฏ ุนูุงูู ุบูุฑ ูุญูููุฉ ูู ุงูุฃุฏุงุก\n"
                            "- ุงูุญุงุฌุฉ ูุชุญุณูู ุฌูุฏุฉ ุงูุจูุงูุงุช ุฃู ุงุฎุชูุงุฑ ูุคุดุฑุงุช ุญูููุฉ ุฃุฎุฑู"
                        )
                    else:
                        st.error(
                            "ุนุฏู ูุฌูุฏ ุนูุงูุฉ ูุงุถุญุฉ ูุดูุฑ ุฅูู ุฃู ุงูุญูููุฉ ุงูุญุงููุฉ ูุง ุชุชุฑุฌู ุฅูู ุฃุฏุงุก ูุงูู ูุญุณูุจุ "
                            "ููุง ูุณุชุฏุนู ูุฑุงุฌุนุฉ ุดุงููุฉ ูุงุณุชุฑุงุชูุฌูุงุช ุงูุญูููุฉ ูุงูุฃุฏุงุก ุงููุงูู.\n"
                            "- ุฅุนุงุฏุฉ ุชูููู ุงูุจูุงูุงุช\n"
                            "- ุฅุนุงุฏุฉ ุชุตููู ูุคุดุฑุงุช ุงูุญูููุฉ\n"
                            "- ุฏุฑุงุณุฉ ุชุฃุซูุฑ ุงูุนูุงูู ุงูุฎุงุฑุฌูุฉ ุจุดูู ุฃูุณุน"
                        )

with tab4:
    st.subheader("4๏ธโฃ ุชูููู ุฌูุฏุฉ ุงูุญูููุฉ")

    with st.expander("๐ ููู ูุชู ุชูููู ุงูุญูููุฉ ูู ุงููููุงุชุ"):
        st.markdown("""
        ุนูุฏ ุฑูุน ููู Excel ุฃู CSV ูุญุชูู ุนูู ูุคุดุฑุงุช ุงูุญูููุฉ ุงูุชุงููุฉ:

        - Transparency
        - Board_Independence
        - Audit_Committee
        - Risk_Committee
        - Shareholder_Rights

        ุชููู ุงูููุตุฉ ุจุญุณุงุจ ูุคุดุฑ ุงูุญูููุฉ ููู ูุคุณุณุฉ ุจููุณ ุงูุทุฑููุฉ ุงููุณุชุฎุฏูุฉ ูู ุงูุชุจููุจ ุงูุฃูู (ูุชูุณุท ูุฑุฌูุญ).
        ุซู ูุชู ุชุญููู:
        - โ ุงููุชูุณุท ุงูุนุงู
        - ๐ ุชูุฒูุน ุงูุฏุฑุฌุงุช ุนุจุฑ ุงููุคุณุณุงุช
        - ๐ง ุชูุตูุงุช ุจูุงุกู ุนูู ุงูุฃุฏุงุก ุงูุนุงู ููุญูููุฉ ูู ุงููุทุงุน.
        """)

    uploaded_file = st.file_uploader("๐ ุงุฑูุน ููู ุชูููู (Excel ุฃู CSV)", type=["xlsx", "csv"])
    if uploaded_file:
        df = pd.read_excel(uploaded_file) if uploaded_file.name.endswith("xlsx") else pd.read_csv(uploaded_file)
        st.dataframe(df)

        required_cols = ["Transparency", "Board_Independence", "Audit_Committee", "Risk_Committee", "Shareholder_Rights"]
        if all(col in df.columns for col in required_cols):
            weights = [0.25, 0.25, 0.2, 0.15, 0.15]
            df["Governance_Score"] = df[required_cols].dot(weights)
            st.success("โ ุชู ุงุญุชุณุงุจ ูุคุดุฑ ุงูุญูููุฉ")
            st.dataframe(df[["Governance_Score"]])

            avg_score = df["Governance_Score"].mean()
            if avg_score >= 8:
                st.info(f"๐ ูุชูุณุท ุงูุญูููุฉ ุนุงูู ({avg_score:.2f})ุ ุงูุฃุฏุงุก ุฌูุฏ.")
            elif avg_score >= 5:
                st.warning(f"โ๏ธ ูุชูุณุท ุงูุญูููุฉ ูุชูุณุท ({avg_score:.2f})ุ ุชูุงูุช ุจูู ุงููุคุณุณุงุช.")
            else:
                st.error(f"โ ูุชูุณุท ุงูุญูููุฉ ุถุนูู ({avg_score:.2f})ุ ุญุงุฌุฉ ูุชุญุณูู.")

            st.markdown("###  ุชูุตูุงุช:")
            if avg_score < 5:
                st.markdown("- ๐๏ธ ุชุญุณูู ุดุงูู ููุญูููุฉ ุนุจุฑ ุงููุคุณุณุงุช.")
            elif avg_score < 8:
                st.markdown("- ๐งฉ ูุดุงุฑูุฉ ุฃูุถู ุงูููุงุฑุณุงุช ุจูู ุงููุคุณุณุงุช.")
            else:
                st.markdown("- โ ุงูุงุณุชูุฑุงุฑ ูู ุงูุชุญุณููุงุช ุงูุญุงููุฉ.")

            fig2 = px.histogram(df, x="Governance_Score", title="ุชูุฒูุน ุฏุฑุฌุงุช ุงูุญูููุฉ")
            st.plotly_chart(fig2)

            # ุดุฑุญ ููุณุฑ ููุชูุฌุฉ ูุชูุณุท ุงูุญูููุฉ
            st.markdown("---")
            st.markdown("#### ๐ ุชูุณูุฑ ูุชูุณุท ูุคุดุฑ ุงูุญูููุฉ:")
            if avg_score >= 8:
                st.success(
                    "ูุชูุณุท ุงูุญูููุฉ ุงูุนุงูู ูุฏู ุนูู ุฃู ุงููุคุณุณุงุช ุจุดูู ุนุงู ุชุญูู ุฌูุฏ ููุณุชูุฑุ ููุฐุง ูุดูุฑ ุฅูู "
                    "ุจูุฆุฉ ุฃุนูุงู ุณูููุฉ ูุชุญูู ูุนุงู."
                )
            elif avg_score >= 5:
                st.warning(
                    "ูุชูุณุท ุงูุญูููุฉ ุงููุชูุณุท ูุนูุณ ุชูุงูุชูุง ูู ุฌูุฏุฉ ุงูุญูููุฉ ุจูู ุงููุคุณุณุงุชุ ูููุตุญ ุจุชุจุงุฏู ุงูุฎุจุฑุงุช "
                    "ูุชุจูู ููุงุฑุณุงุช ุฃูุถู."
                )
            else:
                st.error(
                    "ูุชูุณุท ุงูุญูููุฉ ุงูููุฎูุถ ูุดูุฑ ุฅูู ูุฌูุฏ ูุดุงูู ูุจูุฑุฉ ูู ุงูุญูููุฉ ุนูู ูุณุชูู ุงููุคุณุณุงุชุ "
                    "ููุง ูุณุชุฏุนู ุชุฏุฎูุงุช ุฅุตูุงุญูุฉ ุนุงุฌูุฉ."
                )
        else:
            st.warning("โ๏ธ ุชุฃูุฏ ูู ูุฌูุฏ ุงูุฃุนูุฏุฉ ุงููุทููุจุฉ ูู ุงูููู.")

# ุชุจููุจ 5: ุชุญุณูู ุฑุฃุณ ุงููุงู ุจุนุฏ ุงูุตุฏูุฉ
with tab5:
    st.subheader("5๏ธโฃ ุชุญุณูู ุฑุฃุณ ุงููุงู ุจุนุฏ ุงูุตุฏูุฉ - ุจูููุฏ")

    st.markdown("๐ ูู ูุฐุง ุงููุณู ูุชู ุชุญุณูู ุชูุฒูุน ุฑุฃุณ ุงููุงู ุจุนุฏ ุชุนุฑุถ ุงูุจูู ูุตุฏูุฉุ ูุน ูุฑุงุนุงุฉ ูุณุชููุงุช ุงูุญูููุฉ ูุงููููุฏ ุงูุชูุธูููุฉ.")
    
    with st.expander("๐ ูุง ูู ูููุฌูุฉ ุญุณุงุจ ุฒูู ุชุนุฏูู ุฑุฃุณ ุงููุงูุ"):
        st.markdown("""
        ูุชู ุญุณุงุจ ุฒูู ุชุนุฏูู ุฑุฃุณ ุงููุงู ุจุนุฏ ุงูุตุฏูุฉ ุจูุงุกู ุนูู **ุชูููู ูุณุชูู ุงูุญูููุฉ ููู ูุญุฏุฉ** ูุงูุญุฏ ุงูุฃุฏูู ุงููุคูู ูููุดุงุฑูุฉ ูู ุงูุชุญุณูู:

        - โ ููุท ุงููุญุฏุงุช ุงูุชู ุชุญูู ุญุฏ ุงูุญูููุฉ ุงูุฃุฏูู ุชูุนุชุจุฑ ูุคููุฉ.
        - โฑ๏ธ ุฒูู ุงูุชุนุฏูู ููุญุณุจ ููุณุจุฉ ุจูู ุฑุฃุณ ุงููุงู ุงููุฎุตุต ูููู ูุญุฏุฉ ูุชุฃุซูุฑ ุงูุตุฏูุฉ ูุถุฑูุจูุง ุจุนุงูู ูุนูุณ ูุณุชูู ุงูุญูููุฉ.
        - ๐ก ูููุง ุงุฑุชูุน ูุณุชูู ุงูุญูููุฉุ ูููุง ูู ุฒูู ุชุนุฏูู ุฑุฃุณ ุงููุงูุ ููุง ูุนูุณ ูุฑููุฉ ูุงุณุชุฌุงุจุฉ ุฃุณุฑุน.
        - ๐ ูุชู ูุฑุถ ูููุฏ ุนูู ุงูุญุฏ ุงูุฃูุตู ูุฑุฃุณ ุงููุงู ููู ูุญุฏุฉ ูุถูุงู ุงูุงูุชุฒุงู ุงูุชูุธููู.

        ูุฐู ุงููููุฌูุฉ ุชุชูุญ ุชูุฒูุนูุง ูุชูุงุฒููุง ููุฑููุง ูุฑุฃุณ ุงููุงู ูุชุญุณูู ุณุฑุนุฉ ุงูุชููู ูุน ุงูุตุฏูุงุช ุงููุงููุฉ.
        """)
    
    num_units = st.number_input("๐ข ุนุฏุฏ ุงููุญุฏุงุช", 2, 10, 3)
    total_capital = st.number_input("๐ฐ ุฑุฃุณ ุงููุงู (ููููู)", 0.0, 1000.0, 100.0)
    shock_impact = st.number_input("โ๏ธ ูุนุงูู ุงูุตุฏูุฉ", 0.1, 1.0, 0.3)
    min_gov = st.number_input("๐ ุงูุญุฏ ุงูุฃุฏูู ููุญูููุฉ", 0.0, 10.0, 5.0)
    max_alloc = st.number_input("๐ ุงูุญุฏ ุงูุฃูุตู ูููุญุฏุฉ (ููููู)", 0.0)

    g_arr = [st.number_input(f"ุญูููุฉ ูุญุฏุฉ {i+1}", 0.0, 10.0, 6.0) for i in range(int(num_units))]

    if st.button("๐ ุชุญุณูู ุงูุชูุฒูุน"):
        g_arr = np.array(g_arr)
        eff = g_arr + 1
        eligible = g_arr >= min_gov
        eff[~eligible] = 0
        weights = eff / eff.sum()
        alloc = weights * total_capital
        alloc = np.minimum(alloc, max_alloc)
        unused = total_capital - alloc.sum()
        room = max_alloc - alloc
        if room.sum() > 0 and unused > 0:
            share = room / room.sum()
            alloc += unused * share
        duration = (alloc * shock_impact) / (g_arr + 1)
        df_alloc = pd.DataFrame({
            "ุงููุญุฏุฉ": [f"ูุญุฏุฉ {i+1}" for i in range(num_units)],
            "ูุคููุ": ["โ" if e else "โ" for e in eligible],
            "ูุณุชูู ุงูุญูููุฉ": g_arr,
            "ุฑุฃุณ ุงููุงู ุงููุฎุตุต": alloc,
            "ุฒูู ุงูุชุนุฏูู (ููู)": duration
        })
        st.dataframe(df_alloc.style.format({"ุฑุฃุณ ุงููุงู ุงููุฎุตุต": "{:.2f}", "ุฒูู ุงูุชุนุฏูู (ููู)": "{:.2f}"}))
        st.metric("โฑ๏ธ ุงูุฒูู ุงูููู", f"{duration.sum():.2f} ููููุง")
        fig = px.bar(df_alloc, x="ุงููุญุฏุฉ", y="ุฑุฃุณ ุงููุงู ุงููุฎุตุต", color="ูุคููุ", text="ุฒูู ุงูุชุนุฏูู (ููู)")
        st.plotly_chart(fig)

        # --- ุชุญููู ุงูุญุณุงุณูุฉ ---
        shock_values = np.linspace(0.1, 1.0, 10)  # ููู ูุฎุชููุฉ ููุนุงูู ุงูุตุฏูุฉ
        avg_durations = []
        for val in shock_values:
            dur = (alloc * val) / (g_arr + 1)
            avg_durations.append(dur.mean())

        fig_sensitivity = px.line(
            x=shock_values, y=avg_durations,
            labels={"x": "ูุนุงูู ุงูุตุฏูุฉ", "y": "ูุชูุณุท ุฒูู ุงูุชุนุฏูู (ููู)"},
            title="ุชุญููู ุญุณุงุณูุฉ ูุชูุณุท ุฒูู ุงูุชุนุฏูู ููุนุงู ุงูุตุฏูุฉ"
        )
        st.plotly_chart(fig_sensitivity)

# ุชุจููุจ 6: ุชุญุณูู ุงูุนุงุฆุฏ ุจุงุณุชุฎุฏุงู ูุงูุฑุงูุฌ + ูุคุดุฑุงุช ุงููุฎุงุทุฑ + ูููุฐุฌ ุชุญุณูู ูุชุนุฏุฏ
with tab6:
    st.subheader("6๏ธโฃ ุชุญุณูู ุงูุนุงุฆุฏ ุจุงุณุชุฎุฏุงู ูุถุงุนูุงุช ูุงูุฑุงูุฌ")

    st.markdown("๐ ูู ูุฐุง ุงููุณู ูุชู ุชุญุณูู ุชูุฒูุน ุงูุงุณุชุซูุงุฑุงุช ูุชุญููู ุฃุนูู ุนุงุฆุฏ ูููู ุถูู ูููุฏ ุงููุฎุงุทุฑ ูุงูุญุฏูุฏ ุงูุชูุธูููุฉ.")
    
    with st.expander("๐ ูุง ูู ูููุฌูุฉ ุชุญุณูู ุงูุนุงุฆุฏ ููุงุจู ุงููุฎุงุทุฑุฉุ"):
        st.markdown("""
        ูุชู ุชุญุณูู ุชูุฒูุน ุงูุงุณุชุซูุงุฑุงุช ุนุจุฑ ูุญูุธุฉ ูุงููุฉ ุจุงุณุชุฎุฏุงู **ูุถุงุนูุงุช ูุงูุฑุงูุฌ** ูุชุญููู ุชูุงุฒู ุจูู:

        - ๐ ุฒูุงุฏุฉ ุงูุนุงุฆุฏ ุงููุชููุน ูููุญูุธุฉ.
        - โ๏ธ ุชูููู ุงููุฎุงุทุฑ (ุงูููุงุณุฉ ุจุงูุงูุญุฑุงู ุงููุนูุงุฑู ุฃู ุงูุชุบุงูุฑ).
        - ๐ ุงุญุชุฑุงู ุงููููุฏ ุงูููุฑูุถุฉ ุนูู ุงูุญุฏ ุงูุฃุฏูู ูุงูุฃูุตู ููู ุงุณุชุซูุงุฑ.
        - ๐ฏ ุงุณุชุฎุฏุงู ูููุฐุฌ ุฑูุงุถู ูุนุชูุฏ ุนูู ุฏุงูุฉ ุงููุฏู ุงูุชู ุชูุงุฒู ุจูู ุงูุนุงุฆุฏ ูุงููุฎุงุทุฑ.
        - ๐ค ุชุญููู ุงูุญุณุงุณูุฉ ูููู ุชุฃุซูุฑ ุชุบูุฑ ุงูุนูุงุฆุฏ ุนูู ุงููุญูุธุฉ.

        ูุฐู ุงููููุฌูุฉ ุชุชูุญ ุงุฎุชูุงุฑ ุฃูุถู ุชูุฒูุน ููุฃุตูู ูุชุญููู ุฃูุถู ุฃุฏุงุก ูุงูู ูููู ุถูู ูููุฏ ุงููุฎุงุทุฑ ูุงูุชูุธูู.
        """)

    n_assets = st.number_input("๐ข ุนุฏุฏ ุงูุงุณุชุซูุงุฑุงุช", 2, 10, 3)
    r_list, max_list, min_list = [], [], []
    for i in range(int(n_assets)):
        r = st.number_input(f"๐ ุนุงุฆุฏ ุงูุงุณุชุซูุงุฑ {i+1} (%)", key=f"r{i}")
        m = st.number_input(f"๐ ุงูุญุฏ ุงูุฃูุตู ููุงุณุชุซูุงุฑ {i+1} (%)", 0.0, 100.0, 100.0, key=f"m{i}")
        mn = st.number_input(f"โฌ๏ธ ุงูุญุฏ ุงูุฃุฏูู ููุงุณุชุซูุงุฑ {i+1} (%)", 0.0, 100.0, 0.0, key=f"mn{i}")
        r_list.append(r / 100)
        max_list.append(m / 100)
        min_list.append(mn / 100)

    cov_matrix = np.identity(int(n_assets)) * 0.02  # ุชุบุงูุฑ ุจุณูุท ููู ุฃุตู (ูููู ุงุณุชุจุฏุงูู)

    if st.button("๐ ุชูููุฐ ุชุญุณูู ุงูุนุงุฆุฏ"):

        r = np.array(r_list)
        max_c = np.array(max_list)
        min_c = np.array(min_list)

        base = r / r.sum()
        w = np.maximum(base, min_c)
        w = np.minimum(w, max_c)

        unused = 1.0 - w.sum()
        if unused > 0:
            room = max_c - w
            room[room < 0] = 0
            share = room / room.sum()
            w += unused * share

        if w.sum() > 1:
            w = w / w.sum()

        p_return = np.dot(w, r)
        port_variance = np.dot(w.T, np.dot(cov_matrix, w))
        port_std = np.sqrt(port_variance)

        risk_free_rate = 0.02
        sharpe_ratio = (p_return - risk_free_rate) / port_std if port_std != 0 else 0

        # ุชุญููู ุงูุญุณุงุณูุฉ ููุนุงุฆุฏ
        sensitivity = []
        delta = 0.01
        for i in range(len(r)):
            r_sens = r.copy()
            r_sens[i] += delta
            p_return_sens = np.dot(w, r_sens)
            sensitivity.append((p_return_sens - p_return) / delta)

        equal_w = np.ones_like(w) / len(w)
        equal_return = np.dot(equal_w, r)

        unconstrained_w = base / base.sum()
        unconstrained_return = np.dot(unconstrained_w, r)

        df_result = pd.DataFrame({
            "ุงูุงุณุชุซูุงุฑ": [f"ุงุณุชุซูุงุฑ {i+1}" for i in range(n_assets)],
            "ุงููุฒู ุงูุฃูุซู": w,
            "ุงูุนุงุฆุฏ ุงููุชููุน (%)": r * 100,
            "ุงููุณุงููุฉ ูู ุงูุนุงุฆุฏ (%)": w * r * 100,
            "ุงูุญุฏ ุงูุฃูุตู (%)": max_c * 100,
            "ุงูุญุฏ ุงูุฃุฏูู (%)": min_c * 100,
            "ุญุณุงุณูุฉ ุงูุนุงุฆุฏ": sensitivity
        })

        st.dataframe(df_result.style.format({
            "ุงููุฒู ุงูุฃูุซู": "{:.2%}",
            "ุงููุณุงููุฉ ูู ุงูุนุงุฆุฏ (%)": "{:.2f}",
            "ุงูุญุฏ ุงูุฃูุตู (%)": "{:.2f}",
            "ุงูุญุฏ ุงูุฃุฏูู (%)": "{:.2f}",
            "ุญุณุงุณูุฉ ุงูุนุงุฆุฏ": "{:.4f}"
        }))

        st.metric("๐ ุงูุนุงุฆุฏ ุงูููู ุงููุชููุน", f"{p_return*100:.2f}%")
        st.metric("โ๏ธ ุงูุนุงุฆุฏ ูุน ุชูุฒูุน ูุชุณุงูู", f"{equal_return*100:.2f}%")
        st.metric("๐ ุงูุงูุญุฑุงู ุงููุนูุงุฑู (ูุฎุงุทุฑ ุงููุญูุธุฉ)", f"{port_std*100:.2f}%")
        st.metric("๐ ูุคุดุฑ ุดุงุฑุจ (Sharpe Ratio)", f"{sharpe_ratio:.2f}")

        st.write(f"๐ ุงูุนุงุฆุฏ ุจุฏูู ูููุฏ: {unconstrained_return*100:.2f}%")
        st.write(f"๐ ุงููุฑู ุจุณุจุจ ุงููููุฏ (ูุฌููุน ุงูุฃูุฒุงู ุงููุญุฌูุฒุฉ): {(unconstrained_return - p_return)*100:.2f}%")

        fig = px.bar(df_result, x="ุงูุงุณุชุซูุงุฑ", y="ุงููุฒู ุงูุฃูุซู", color="ุงูุนุงุฆุฏ ุงููุชููุน (%)",
                     labels={"ุงููุฒู ุงูุฃูุซู": "ุงููุฒู ุงูุฃูุซู (%)", "ุงูุนุงุฆุฏ ุงููุชููุน (%)": "ุงูุนุงุฆุฏ ุงููุชููุน (%)"})
        st.plotly_chart(fig)

        # --- ูููุฐุฌ ุชุญุณูู ุงูุนุงุฆุฏ ููุงุจู ุงููุฎุงุทุฑุฉ ุจุงุณุชุฎุฏุงู cvxpy ---
        st.subheader("ุชุญุณูู ุงูุนุงุฆุฏ ููุงุจู ุงููุฎุงุทุฑุฉ ุจุงุณุชุฎุฏุงู CVXPY")

        n = len(r_list)
        w_var = cp.Variable(n)
        r_arr = np.array(r_list)
        cov = np.diag(np.full(n, 0.02)) 

        _lambda = 0.1  # ูุนุงููุฉ ุงููุฎุงุทุฑุฉ

        objective = cp.Maximize(r_arr.T @ w_var - _lambda * cp.quad_form(w_var, cov))
        constraints = [cp.sum(w_var) == 1, w_var >= 0]
        prob = cp.Problem(objective, constraints)
        prob.solve()

        optimal_weights = w_var.value

        df_opt = pd.DataFrame({
            "ุงูุงุณุชุซูุงุฑ": [f"ุงุณุชุซูุงุฑ {i+1}" for i in range(n)],
            "ุงููุฒู ุงูุฃูุซู (CVXPY)": optimal_weights
        })
        st.dataframe(df_opt.style.format({"ุงููุฒู ุงูุฃูุซู (CVXPY)": "{:.2%}"}))

        # ุชูุตูุงุช ุฐููุฉ ุจูุงุกู ุนูู ุงููุชุงุฆุฌ
        st.markdown("### ๐ค ุชูุตูุงุช:")
        if sharpe_ratio < 1:
            st.warning("ูุฎุงุทุฑ ุงููุญูุธุฉ ุนุงููุฉ ูุณุจููุงุ ูููุตุญ ุจุฅุนุงุฏุฉ ุชูุฒูุน ุงูุฃูุฒุงู ุฃู ุฒูุงุฏุฉ ุงูุชูููุน.")
        else:
            st.success("ุงููุญูุธุฉ ูุชูุงุฒูุฉ ุฌูุฏูุง ูุน ุนุงุฆุฏ ููุฎุงุทุฑ ูุญุณูุจุฉ.")
